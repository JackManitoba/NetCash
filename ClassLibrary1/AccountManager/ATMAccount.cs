using Helpers.Utils;
using System.ComponentModel.DataAnnotations;
using System.Diagnostics;
using System;

namespace Helpers.AccountManager
{
    public class ATMAccount : Account
    {
        [Required]
        [Display(Name = "PIN")]
        public string pin { get; set; }

        [Required]
        [Display(Name = "Card Number")]
        public string cardNumber { get; set; }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        public ATMAccount(string _accountnumber) : base(_accountnumber)
        {
            this.pin = GetPin();
            Debug.WriteLine("Account pin: " + pin);
        }
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        private string GetPin()
        {
            
       
            return DatabaseManager.getInstance().GetATMAccountPin(this.AccountNumber);
        }
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        public bool IsValid(string s)
        {
            string currentPin = GetPin();
            if (s == currentPin)
                return true;
            else
                return false;
        }

         /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        public void updatePin(string newPin)
        {
            DatabaseManager.getInstance().updateATMPinNumber(this.AccountNumber, newPin);
            this.pin = DatabaseManager.getInstance().GetATMAccountPin(AccountNumber);

            
        }
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        public static string getAccountByCardNumber(string _cardNumber)
        {
           return DatabaseManager.getAccountByATMCardNumber(_cardNumber);
        }
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    }
}
